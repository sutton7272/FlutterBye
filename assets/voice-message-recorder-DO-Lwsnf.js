import{a3 as z,r as i,b as F,j as e,C as G,e as H,f as W,V as L,a as q,B as S,h as d,ah as J,ab as K,ad as Q,ac as X,bv as V,aB as Y}from"./index-CeACcdR0.js";import{M as B}from"./music-zfdWUr0c.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=z("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);function se({onVoiceAttached:w,maxDuration:x=60,showMusicUpload:E=!0}){const[l,N]=i.useState(!1),[R,f]=i.useState(!1),[g,j]=i.useState(0),[r,M]=i.useState(null),[m,k]=i.useState(0),[n,U]=i.useState(null),v=i.useRef(null),b=i.useRef([]),p=i.useRef(null),u=i.useRef(null),A=i.useRef(null),{toast:c}=F();i.useEffect(()=>()=>{u.current&&clearInterval(u.current),r&&URL.revokeObjectURL(r)},[r]);const I=async()=>{try{const a=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(a);v.current=t,b.current=[],t.ondataavailable=s=>{b.current.push(s.data)},t.onstop=()=>{const s=new Blob(b.current,{type:"audio/wav"}),o=URL.createObjectURL(s);M(o);const h=new Audio(o);h.onloadedmetadata=()=>{k(h.duration)},a.getTracks().forEach($=>$.stop())},t.start(),N(!0),j(0),u.current=setInterval(()=>{j(s=>s>=x?(y(),s):s+1)},1e3),c({title:"Recording Started",description:"Speak clearly for best quality"})}catch(a){console.error("Error starting recording:",a),c({title:"Recording Error",description:"Could not access microphone",variant:"destructive"})}},y=()=>{v.current&&l&&(v.current.stop(),N(!1),u.current&&(clearInterval(u.current),u.current=null),c({title:"Recording Complete",description:`${g}s voice message recorded`}))},P=()=>{p.current&&(R?(p.current.pause(),f(!1)):(p.current.play(),f(!0)))},O=async()=>{if(r&&m>0)try{c({title:"Processing Voice",description:"Analyzing audio with AI..."});const t=await(await fetch(r)).blob(),s=new FileReader;s.onloadend=()=>{const o=s.result;w({url:r,duration:m,type:"voice",audioData:o}),c({title:"Voice Attached Successfully",description:`${Math.round(m)}s voice message ready for AI emotion analysis`}),C()},s.readAsDataURL(t)}catch(a){console.error("Error processing voice:",a),c({title:"Processing Failed",description:"Unable to process voice message. Please try again.",variant:"destructive"})}},D=a=>{var s;const t=(s=a.target.files)==null?void 0:s[0];if(t&&t.type.startsWith("audio/")){const o=URL.createObjectURL(t),h=new Audio(o);h.onloadedmetadata=()=>{U({name:t.name,url:o,duration:h.duration}),c({title:"Music Uploaded",description:`${t.name} ready to attach`})}}},T=async()=>{if(n)try{const t=await(await fetch(n.url)).blob(),s=new FileReader;s.onloadend=()=>{const o=s.result;w({url:n.url,duration:n.duration,type:"music",audioData:o}),c({title:"Music Attached",description:`${n.name} added to your message`})},s.readAsDataURL(t)}catch(a){console.error("Error processing music:",a),c({title:"Error",description:"Failed to process music file",variant:"destructive"})}},C=()=>{r&&(URL.revokeObjectURL(r),M(null),k(0),j(0))};return e.jsxs(G,{className:"bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-purple-400/30",children:[e.jsx(H,{children:e.jsxs(W,{className:"text-white flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-purple-400"}),"Voice & Music Attachment ðŸŽµ"]})}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-medium",children:"Voice Message"}),e.jsx(S,{className:`${l?"bg-red-600/20 text-red-200 animate-pulse":"bg-purple-600/20 text-purple-200"}`,children:l?"Recording...":r?"Recorded":"Ready"})]}),r?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{size:"sm",onClick:P,className:"w-8 h-8 rounded-full bg-purple-600 hover:bg-purple-700",children:R?e.jsx(Q,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-white font-medium",children:"Voice Message"}),e.jsxs("div",{className:"text-gray-400",children:[Math.round(m),"s duration"]})]})]}),e.jsx(d,{size:"sm",variant:"outline",onClick:C,className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs(d,{onClick:O,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Attach Voice Message"]})]}):e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(d,{onMouseDown:I,onMouseUp:y,onMouseLeave:y,disabled:l,className:`w-16 h-16 rounded-full ${l?"bg-red-600 hover:bg-red-700 animate-pulse":"bg-purple-600 hover:bg-purple-700"}`,children:l?e.jsx(Z,{className:"h-6 w-6"}):e.jsx(J,{className:"h-6 w-6"})}),e.jsx("div",{className:"text-sm text-gray-400",children:l?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-red-400 font-bold",children:["Recording: ",g,"s / ",x,"s"]}),e.jsx(K,{value:g/x*100,className:"h-2"})]}):"Hold to record voice message"})]})]}),E&&e.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white font-medium",children:"Background Music"}),e.jsx(S,{className:"bg-blue-600/20 text-blue-200",children:"Optional"})]}),n?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-5 w-5 text-blue-400"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-white font-medium",children:n.name}),e.jsxs("div",{className:"text-gray-400",children:[Math.round(n.duration),"s"]})]})]}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>U(null),className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs(d,{onClick:T,className:"w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Attach Background Music"]})]}):e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs(d,{onClick:()=>{var a;return(a=A.current)==null?void 0:a.click()},variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Upload Music/Song"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Supports MP3, WAV, OGG files"}),e.jsx("input",{ref:A,type:"file",accept:"audio/*",onChange:D,className:"hidden"})]})]}),r&&e.jsx("audio",{ref:p,src:r,onEnded:()=>f(!1),className:"hidden"})]})]})}export{se as VoiceMessageRecorder};
