import{r as d,b as G,am as m,j as e,C as o,a as x,aj as O,a8 as q,o as H,as as V,bk as X,h,aM as J,at as K,au as Q,av as W,aG as v,I as u,e as Y,f as Z,b9 as _,aJ as ee,b0 as se,B as D,s as ae,t as te,v as le,w as re,x as ie,a$ as ne,a6 as ce,X as de,$ as oe}from"./index-CeACcdR0.js";import{C as xe}from"./credit-card-BeYrZ9L8.js";function pe(){var F;const[n,b]=d.useState([]),[f,$]=d.useState([]),[p,w]=d.useState(null),[t,r]=d.useState({}),[me,y]=d.useState(!1),[k,C]=d.useState(!1),{toast:i}=G();d.useEffect(()=>{g()},[]);const g=async()=>{y(!0);try{const s=await m("GET","/api/subscription/plans");if(s.ok){const l=await s.json();b(Object.values(l))}const a=await m("GET","/api/admin/subscriptions");if(a.ok){const l=await a.json();$(l.subscriptions||[])}}catch(s){console.error("Error loading data:",s)}finally{y(!1)}},T=s=>{w(s.id),r({...s})},S=()=>{w(null),r({})},R=async()=>{if(!(!p||!t))try{if((await m("PUT",`/api/admin/subscription/plans/${p}`,t)).ok)i({title:"Plan Updated",description:"Subscription plan has been updated successfully."}),b(n.map(a=>a.id===p?{...a,...t}:a)),S();else throw new Error("Failed to update plan")}catch{i({title:"Update Failed",description:"Failed to update subscription plan.",variant:"destructive"})}},U=async()=>{try{const s=await m("POST","/api/admin/subscription/plans",t);if(s.ok){const a=await s.json();i({title:"Plan Created",description:"New subscription plan has been created successfully."}),b([...n,a]),C(!1),r({})}else throw new Error("Failed to create plan")}catch{i({title:"Creation Failed",description:"Failed to create subscription plan.",variant:"destructive"})}},I=async(s,a)=>{try{if((await m("PUT",`/api/subscription/${s}`,{newPlan:a})).ok)i({title:"Subscription Updated",description:"Customer subscription has been updated successfully."}),g();else throw new Error("Failed to update subscription")}catch{i({title:"Update Failed",description:"Failed to update customer subscription.",variant:"destructive"})}},L=async s=>{try{if((await m("DELETE",`/api/subscription/${s}`)).ok)i({title:"Subscription Cancelled",description:"Customer subscription has been cancelled successfully."}),g();else throw new Error("Failed to cancel subscription")}catch{i({title:"Cancellation Failed",description:"Failed to cancel customer subscription.",variant:"destructive"})}},A=s=>{switch(s){case"basic":return oe;case"pro":return de;case"enterprise":return ce;default:return ne}},z=s=>{switch(s){case"basic":return"purple";case"pro":return"yellow";case"enterprise":return"cyan";default:return"gray"}},P=n.reduce((s,a)=>s+(a.monthlyRevenue||0),0),N=n.reduce((s,a)=>s+(a.subscriberCount||0),0),M=N>0?P/N:0;return e.jsx("div",{className:"min-h-screen p-6 pt-20 bg-slate-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-cyan-400 via-purple-400 to-cyan-600 bg-clip-text text-transparent mb-4",children:"Subscription Management"}),e.jsx("p",{className:"text-slate-400 text-lg",children:"Manage subscription plans, pricing, and customer subscriptions"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(o,{className:"bg-slate-800/50 border-cyan-500/20",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-cyan-400",children:["$",P.toLocaleString()]})]}),e.jsx(O,{className:"w-8 h-8 text-cyan-400"})]})})}),e.jsx(o,{className:"bg-slate-800/50 border-purple-500/20",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Active Subscribers"}),e.jsx("p",{className:"text-2xl font-bold text-purple-400",children:N.toLocaleString()})]}),e.jsx(q,{className:"w-8 h-8 text-purple-400"})]})})}),e.jsx(o,{className:"bg-slate-800/50 border-yellow-500/20",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"ARPU"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-400",children:["$",M.toFixed(2)]})]}),e.jsx(H,{className:"w-8 h-8 text-yellow-400"})]})})}),e.jsx(o,{className:"bg-slate-800/50 border-green-500/20",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Plans Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:n.length})]}),e.jsx(xe,{className:"w-8 h-8 text-green-400"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Subscription Plans"}),e.jsxs(V,{open:k,onOpenChange:C,children:[e.jsx(X,{asChild:!0,children:e.jsxs(h,{className:"bg-gradient-to-r from-cyan-500 to-purple-600 hover:from-cyan-600 hover:to-purple-700",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"New Plan"]})}),e.jsxs(K,{className:"bg-slate-800 border-slate-700",children:[e.jsx(Q,{children:e.jsx(W,{className:"text-white",children:"Create New Plan"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{className:"text-slate-300",children:"Plan Name"}),e.jsx(u,{value:t.name||"",onChange:s=>r({...t,name:s.target.value}),className:"bg-slate-700 border-slate-600 text-white",placeholder:"e.g., Premium"})]}),e.jsxs("div",{children:[e.jsx(v,{className:"text-slate-300",children:"Price (USD)"}),e.jsx(u,{type:"number",value:t.price||"",onChange:s=>r({...t,price:parseFloat(s.target.value)}),className:"bg-slate-700 border-slate-600 text-white",placeholder:"29.99"})]}),e.jsxs("div",{children:[e.jsx(v,{className:"text-slate-300",children:"Features (comma-separated)"}),e.jsx(u,{value:((F=t.features)==null?void 0:F.join(", "))||"",onChange:s=>r({...t,features:s.target.value.split(", ")}),className:"bg-slate-700 border-slate-600 text-white",placeholder:"Feature 1, Feature 2, Feature 3"})]}),e.jsx(h,{onClick:U,className:"w-full bg-cyan-600 hover:bg-cyan-700",children:"Create Plan"})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:n.map(s=>{var E;const a=A(s.id),l=z(s.id),j=p===s.id;return e.jsxs(o,{className:`bg-slate-800/50 border-${l}-500/20`,children:[e.jsx(Y,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 bg-${l}-500/20 rounded-lg`,children:e.jsx(a,{className:`w-6 h-6 text-${l}-400`})}),j?e.jsx(u,{value:t.name||"",onChange:c=>r({...t,name:c.target.value}),className:"bg-slate-700 border-slate-600 text-white text-lg font-bold"}):e.jsx(Z,{className:`text-xl text-${l}-400`,children:s.name})]}),e.jsx("div",{className:"flex items-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm",onClick:R,className:"bg-green-600 hover:bg-green-700",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",variant:"outline",onClick:S,className:"border-red-500/30 text-red-400",children:e.jsx(ee,{className:"w-4 h-4"})})]}):e.jsx(h,{size:"sm",variant:"outline",onClick:()=>T(s),className:"border-slate-600 text-slate-300",children:e.jsx(se,{className:"w-4 h-4"})})})]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Price:"}),j?e.jsx(u,{type:"number",value:t.price||"",onChange:c=>r({...t,price:parseFloat(c.target.value)}),className:"w-24 bg-slate-700 border-slate-600 text-white"}):e.jsxs("span",{className:"text-white font-bold",children:["$",s.price,"/month"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-slate-400",children:"Features:"}),j?e.jsx(u,{value:((E=t.features)==null?void 0:E.join(", "))||"",onChange:c=>r({...t,features:c.target.value.split(", ")}),className:"bg-slate-700 border-slate-600 text-white"}):e.jsx("div",{className:"flex flex-wrap gap-2",children:s.features.map((c,B)=>e.jsx(D,{variant:"outline",className:"border-slate-600 text-slate-300",children:c},B))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Subscribers"}),e.jsx("p",{className:"text-lg font-bold text-white",children:s.subscriberCount||0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Monthly Revenue"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:["$",(s.monthlyRevenue||0).toLocaleString()]})]})]})]})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Active Subscriptions"}),e.jsxs("div",{className:"space-y-4",children:[f.map(s=>e.jsx(o,{className:"bg-slate-800/50 border-slate-700",children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.customerEmail}),e.jsxs("p",{className:"text-sm text-slate-400",children:["ID: ",s.id]})]}),e.jsx(D,{variant:s.status==="active"?"default":"destructive",className:s.status==="active"?"bg-green-600":"bg-red-600",children:s.status})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Current Plan:"}),e.jsx("span",{className:"text-white font-medium",children:s.planId})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Period Ends:"}),e.jsx("span",{className:"text-white",children:new Date(s.currentPeriodEnd*1e3).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(ae,{onValueChange:a=>I(s.id,a),children:[e.jsx(te,{className:"bg-slate-700 border-slate-600 text-white",children:e.jsx(le,{placeholder:"Change Plan"})}),e.jsx(re,{children:n.map(a=>e.jsxs(ie,{value:a.id,children:[a.name," - $",a.price,"/mo"]},a.id))})]}),e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>L(s.id),children:"Cancel"})]})]})]})},s.id)),f.length===0&&e.jsx(o,{className:"bg-slate-800/50 border-slate-700",children:e.jsx(x,{className:"p-6 text-center",children:e.jsx("p",{className:"text-slate-400",children:"No active subscriptions found."})})})]})]})]})]})})}export{pe as default};
