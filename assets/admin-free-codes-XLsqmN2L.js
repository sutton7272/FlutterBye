import{b as K,r,c as Q,d as h,j as e,bW as p,C as w,e as S,f as U,aM as O,g as E,a as D,aG as j,I as V,h as d,a$ as H,s as A,t as F,v as T,w as k,x as t,aw as J,aL as Y,bv as W,B as c,am as g,a0 as v}from"./index-CeACcdR0.js";import{T as M}from"./ticket-CTzgytHP.js";function _(){const{toast:n}=K(),[l,o]=r.useState(""),[C,y]=r.useState("1"),[x,f]=r.useState("30"),[N,b]=r.useState(!1),{data:i,isLoading:L}=Q({queryKey:["/api/admin/redemption-codes"]}),m=h({mutationFn:async s=>await g("/api/admin/redemption-codes",{method:"POST",body:JSON.stringify(s)}),onSuccess:()=>{v.invalidateQueries({queryKey:["/api/admin/redemption-codes"]}),o(""),y("1"),f("30"),n({title:"Code Created",description:"Redemption code has been created successfully"})}}),R=h({mutationFn:async({id:s,isActive:a})=>await g(`/api/admin/redemption-codes/${s}/toggle`,{method:"PATCH",body:JSON.stringify({isActive:a})}),onSuccess:()=>{v.invalidateQueries({queryKey:["/api/admin/redemption-codes"]}),n({title:"Code Updated",description:"Code status has been updated"})}}),$=h({mutationFn:async s=>await g(`/api/admin/redemption-codes/${s}`,{method:"DELETE"}),onSuccess:()=>{v.invalidateQueries({queryKey:["/api/admin/redemption-codes"]}),n({title:"Code Deleted",description:"Redemption code has been deleted"})}}),q=()=>{b(!0);const s="FLBY-FREE",a=Date.now().toString().slice(-6),u=Math.random().toString(36).substring(2,5).toUpperCase(),z=`${s}-${a}-${u}`;o(z),setTimeout(()=>b(!1),500)},B=()=>{if(!l.trim()){n({title:"Code Required",description:"Please enter a redemption code",variant:"destructive"});return}const s=x==="0"?null:new Date(Date.now()+parseInt(x)*24*60*60*1e3);m.mutate({code:l.toUpperCase(),maxUses:parseInt(C),currentUses:0,isActive:!0,createdBy:"admin-user-1",expiresAt:s})},I=s=>{navigator.clipboard.writeText(s),n({title:"Copied",description:"Code copied to clipboard"})},P=s=>{const a=s.expiresAt&&new Date(s.expiresAt)<new Date,u=s.currentUses>=s.maxUses;return s.isActive?a?e.jsx(c,{variant:"destructive",children:"Expired"}):u?e.jsx(c,{variant:"outline",children:"Exhausted"}):e.jsx(c,{variant:"default",className:"bg-green-600",children:"Active"}):e.jsx(c,{variant:"secondary",children:"Inactive"})},G=s=>s.maxUses===-1?`${s.currentUses} uses (unlimited)`:`${s.currentUses}/${s.maxUses} uses`;return L?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx(p,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gradient",children:"Free Message Codes"}),e.jsx("p",{className:"text-muted-foreground",children:"Generate and manage redemption codes for free Flutterbye messages"})]})}),e.jsxs(w,{className:"premium-card electric-frame",children:[e.jsxs(S,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-purple-500"}),"Generate New Code"]}),e.jsx(E,{children:"Create redemption codes that users can enter to mint free Flutterbye messages"})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"code",children:"Redemption Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{id:"code",value:l,onChange:s=>o(s.target.value.toUpperCase()),placeholder:"FLBY-FREE-2024-001",className:"font-mono"}),e.jsx(d,{type:"button",variant:"outline",onClick:q,disabled:N,children:N?e.jsx(p,{size:"sm"}):e.jsx(H,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"maxUses",children:"Max Uses"}),e.jsxs(A,{value:C,onValueChange:y,children:[e.jsx(F,{children:e.jsx(T,{})}),e.jsxs(k,{children:[e.jsx(t,{value:"1",children:"1 use"}),e.jsx(t,{value:"5",children:"5 uses"}),e.jsx(t,{value:"10",children:"10 uses"}),e.jsx(t,{value:"25",children:"25 uses"}),e.jsx(t,{value:"50",children:"50 uses"}),e.jsx(t,{value:"100",children:"100 uses"}),e.jsx(t,{value:"-1",children:"Unlimited"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"expiry",children:"Expiry"}),e.jsxs(A,{value:x,onValueChange:f,children:[e.jsx(F,{children:e.jsx(T,{})}),e.jsxs(k,{children:[e.jsx(t,{value:"1",children:"1 day"}),e.jsx(t,{value:"7",children:"1 week"}),e.jsx(t,{value:"30",children:"1 month"}),e.jsx(t,{value:"90",children:"3 months"}),e.jsx(t,{value:"365",children:"1 year"}),e.jsx(t,{value:"0",children:"Never expires"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(d,{onClick:B,disabled:m.isPending,className:"w-full",children:m.isPending?e.jsx(p,{size:"sm"}):"Create Code"})})]})})]}),e.jsxs(w,{className:"premium-card electric-frame",children:[e.jsxs(S,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-500"}),"Active Codes (",(i==null?void 0:i.length)||0,")"]}),e.jsx(E,{children:"Manage existing redemption codes and monitor usage"})]}),e.jsx(D,{children:i&&i.length>0?e.jsx("div",{className:"space-y-3",children:i.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-slate-200 dark:border-slate-700 rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("code",{className:"font-mono text-sm bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded",children:s.code}),P(s)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsx("span",{children:G(s)}),s.expiresAt&&e.jsxs("span",{children:["Expires: ",new Date(s.expiresAt).toLocaleDateString()]}),e.jsxs("span",{children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>I(s.code),children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(Y,{checked:s.isActive,onCheckedChange:a=>R.mutate({id:s.id,isActive:a})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>$.mutate(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(W,{className:"w-4 h-4"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(M,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No redemption codes created yet"}),e.jsx("p",{className:"text-sm",children:"Create your first code above to get started"})]})})]})]})}export{_ as default};
